{# src/Pn/PnBundle/Resources/views/Babysitter/index.html.twig #}

{% import "PnPnBundle::calendar.html.twig" as calendar %}
{% extends "PnPnBundle::layout.html.twig" %}

{% block title %}{{ parent() }} - Annonces{% endblock %}

{% block metadata %}
    {{ parent() }}
    <meta name="description" content="Comparer les profils de nounou par proximité géographique, disponibilité, langue, prix et autres critères.">
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/pnpn/css/availability.css') }}" type="text/css" />
    <link rel="stylesheet" href="{{ asset('bundles/pnpn/css/bootstrap-select.min.css') }}" type="text/css" />
{% endblock %}

{% block body %}
    <div class="maptool wrap">
        <div id="map">
            Veuillez patienter pendant le chargement de la carte...
        </div>
        <div class="searchForm">
            <form action="{{ path('pn_search') }}" method="post" id="searchForm" onsubmit="return sumbmitSearchForm()">
                <select class="selectpicker" name="searchType">
                    <option value="nounou">Je cherche une nounou</option>
                    <option value="job">Je cherche un job</option>
                </select>
                <input id="pac-input" name="field" class="search" type="search" autocomplete="true" placeholder="Indiquez votre ville ou votre code postal">
                <input type="hidden" value="" name="placeTop">
                <input type="hidden" value="" name="placeBottom">
                <input type="hidden" value="" name="placeLeft">
                <input type="hidden" value="" name="placeRight">
                <input type="submit" value="chercher" class="btn bg-yellow submit">
            </form>
        </div>
    </div>

    <div class="wrap" style="position: relative;">
    <aside>

        <div class="panel-group" id="accordion">
            <div class="panel" style="border-top: none;">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            Disponibilités
                        </a>
                    </h4>
                </div>
                <div id="collapseOne" class="panel-collapse collapse in">
                    <div class="panel-body" style="margin-left: 0;">
                        {{ calendar.sortTable() }}
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                            Catégorie de nounou
                        </a>
                    </h4>
                </div>
                <div id="collapseTwo" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="checkbox" name="category[babysitter]" checked="checked">Baby sitter<br>
                        <input type="checkbox" name="category[assistanteMaternelle]" checked="checked">Assistante maternelle<br>
                        <input type="checkbox" name="category[animatrice]" checked="checked">Animatrice<br>
                        <input type="checkbox" name="category[nounou]" checked="checked">Nounou à domicile<br>
                        <input type="checkbox" name="category[aupair]" checked="checked">Jeune fille au pair<br>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                            Expérience exigée
                        </a>
                    </h4>
                </div>
                <div id="collapseThree" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="radio" name=experience value=0 checked>Pas d'exigence<br>
                        <input type="radio" name=experience value=1 >1 an<br>
                        <input type="radio" name=experience value=3 >3 ans<br>
                        <input type="radio" name=experience value=10 >10 ans
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">
                            Ages pris en charge
                        </a>
                    </h4>
                </div>
                <div id="collapseFour" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="checkbox" name="age[0-1]">0-1 an<br>
                        <input type="checkbox" name="age[1-3]">1-3 ans<br>
                        <input type="checkbox" name="age[3-6]">3-6 ans<br>
                        <input type="checkbox" name="age[6-10]">6-10 ans<br>
                        <input type="checkbox" name="age[10+]">Plus de 10 ans<br>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive">
                            Langues parlées
                        </a>
                    </h4>
                </div>
                <div id="collapseFive" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="checkbox" name="language[fr]">Français<br>
                        <input type="checkbox" name="language[en]">Anglais<br>
                        <input type="checkbox" name="language[it]">Italien<br>
                        <input type="checkbox" name="language[es]">Espagnol<br>
                        <input type="checkbox" name="language[ru]">Russe<br>
                        <input type="checkbox" name="language[other]">Autre<br>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseSix">
                            Particularités
                        </a>
                    </h4>
                </div>
                <div id="collapseSix" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="checkbox" name="particularite[nonfumeur]">Non fumeur<br>
                        <input type="checkbox" name="particularite[animaux]">Pas d'animaux domestiques<br>
                        <input type="checkbox" name="particularite[permis]">Avec permis de conduire<br>
                        <input type="checkbox" name="particularite[voiture]">Avec voiture<br>
                        <input type="checkbox" name="particularite[lettre]">Lettres de recommandation<br>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseSeven">
                            Petits plus
                        </a>
                    </h4>
                </div>
                <div id="collapseSeven" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="checkbox" name="petitplus[repasmaison]">Repas cuisinés maison<br>
                        <input type="checkbox" name="petitplus[bio]">Repas bio<br>
                        <input type="checkbox" name="petitplus[promenade]">Promenade quotidienne<br>
                        <input type="checkbox" name="petitplus[notv]">Zéro télé<br>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseHeight">
                            Taches supplémentaires
                        </a>
                    </h4>
                </div>
                <div id="collapseHeight" class="panel-collapse collapse">
                    <div class="panel-body">
                        <input type="checkbox" name="extraTask[cleaning]">Ménage<br>
                        <input type="checkbox" name="extraTask[cooking]">Cuisine<br>
                        <input type="checkbox" name="extraTask[ironing]">Repassage<br>
                        <input type="checkbox" name="extraTask[homework]">Aide aux devoirs<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="mini-map" style="height: 160px">
            Veuillez patienter pendant le chargement de la carte...
        </div>

        {% if app.user %}
            {% if app.user.type == 'nounou' %}
                <a href="{{ path('myprofile_edit') }}" class="btn bg-yellow white">Complétez votre profil !</a>
            {% else %}
                <a href="{{ path('myprofile_edit') }}" class="btn bg-yellow white">Publiez votre annonce !</a>
            {% endif %}
        {% endif %}

    </aside>

    <div class="profiles">
        {% for entity in entities %}
            <a href="{{ path('babysitter_show', {'id': entity.id, 'url': entity.url}) }}">
                <div class="profile" id="{{ entity.id }}"
                     data-calendar="{{ entity.calendar }}"
                     data-trustpoints="{{ entity.trustpoints }}"
                     data-category="{{ entity.category }}"
                     data-experience="{{ entity.experience }}"
                     data-age={% autoescape false %}'{{ entity.getAgeOfChildren()|json_encode() }}'{% endautoescape %}
                     data-language="{{ entity.getLanguages()|json_encode() }}"
                     data-particularite="{{ entity.getParticularite()|json_encode() }}"
                     data-petitplus="{{ entity.getPetitsPlus()|json_encode() }}"
                     data-extraTasks="{{ entity.getExtraTasks()|json_encode() }}">
                    <div class="header">
                        {% if entity.user.avatar %}
                            <img class="photo" src="{{ asset('uploads/users/' ~ entity.user.avatar) }}" alt="photo de profil de {{ entity.user.firstname }}" style="height: 120px;">
                        {% else %}
                            <img src="{{ asset('bundles/pnpn/images/illus/nounou.jpg') }}" alt="{{ entity.user.hiddenName }}" class="photo" style="height: 120px;">
                        {% endif %}
                        {% if entity.ratePrice and entity.rateType %}
                            <p class="tarif">{{ entity.ratePrice }}€ / {{ entity.user.rateTypes[entity.rateType] }}</p>
                        {% endif %}
                        {% if app.user %}
                            <strong>{{ entity.user.fullName()|title }}&nbsp;</strong>
                        {% else %}
                            <strong>{{ entity.user.hiddenName() }}&nbsp;</strong>
                        {% endif %}
                        {% if entity.trustpoints >= 10 %}
                            <span class="balloon"></span>
                        {% endif %}
                        {% if entity.trustpoints >= 20 %}
                            <span class="balloon"></span>
                        {% endif %}
                        {% if entity.trustpoints >= 30 %}
                            <span class="balloon"></span>
                        {% endif %}
                        {% if entity.trustpoints >= 40 %}
                            <span class="balloon"></span>
                        {% endif %}
                        {% if entity.trustpoints >= 50 %}
                            <span class="balloon"></span>
                        {% endif %}
                    </div>
                    <div class="body">
                        <p>
                            {{ entity.shortPresentation(65)|raw|lower|capitalize }}<br>
                            <strong>
                                {#<img src="{{ asset('bundles/pnpn/images/icons/profil-badge.png') }}" alt="badge"> 5 Badges&nbsp;&nbsp;#}
                                {% if entity.experience %}
                                    <img src="{{ asset('bundles/pnpn/images/icons/profil-experience.png') }}" alt="experience"> {{ entity.experience }} ans&nbsp;&nbsp;
                                {% endif %}
                                {% if entity.languages %}
                                    <img src="{{ asset('bundles/pnpn/images/icons/profil-languages.png') }}" alt="laguages">
                                    {% for pp in entity.languages %}
                                        {{ entity.user.getLanguagess[pp] }}
                                        {% if not loop.last %}
                                            ,&nbsp;
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </strong>
                        </p>
                    </div>
                </div>
            </a>
        {% endfor %}

    </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&libraries=places"></script>
    <script type="text/javascript">

        //Chargement des icones
        var icon_grey = "{{ asset('bundles/pnpn/images/markers/marqueur-grey.png') }}";
        var icon_jaune = "{{ asset('bundles/pnpn/images/markers/marqueur-jaune.png') }}";
        var icon_rouge = "{{ asset('bundles/pnpn/images/markers/marqueur-rouge.png') }}";

        var latlng = new google.maps.LatLng(46.7592690, 2.8603553);
        {% if mapTop and mapBottom and mapLeft and mapRight %}
        var bounds = new google.maps.LatLngBounds();
        bounds.extend(new google.maps.LatLng({{ mapTop }}, {{ mapLeft }}));
        bounds.extend(new google.maps.LatLng({{ mapBottom }}, {{ mapRight }}));
        {% endif %}
        // paris : 48.8575162	2.3426246
        //objet contenant des propriétés avec des identificateurs prédéfinis dans Google Maps permettant
        //de définir des options d'affichage de notre carte
        var options = {
            center: latlng,
            zoom: 5,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        //constructeur de la carte qui prend en paramêtre le conteneur HTML
        //dans lequel la carte doit s'afficher et les options
        var map = new google.maps.Map(document.getElementById("map"), options);
        var minimap = new google.maps.Map(document.getElementById("mini-map"), options);

        // Input du lieu
        var input = /** @type {HTMLInputElement} */(
                document.getElementById('pac-input'));
        var autocomplete = new google.maps.places.Autocomplete(input);
        //autocomplete.bindTo('bounds', map);
        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var place = autocomplete.getPlace();
            if (place.geometry)
            {
                $('input[name="placeTop"]').val(place.geometry.viewport.getNorthEast().lat());
                $('input[name="placeBottom"]').val(place.geometry.viewport.getSouthWest().lat());
                $('input[name="placeLeft"]').val(place.geometry.viewport.getSouthWest().lng());
                $('input[name="placeRight"]').val(place.geometry.viewport.getNorthEast().lng());
            }
        });

        //Positionnement des nounou
        {% for entity in entities %}
        {% if entity.user.latitude and entity.user.longitude %}
        var nounou_position{{ loop.index }} = new google.maps.LatLng({{ entity.user.latitude }},{{ entity.user.longitude }});
        var nounou_m{{ loop.index }} = new google.maps.Marker({
            position: nounou_position{{ loop.index }},
            map: map,
            icon: icon_grey
        });
        var nounou2_m{{ loop.index }} = new google.maps.Marker({
            position: nounou_position{{ loop.index }},
            map: minimap,
            icon: icon_grey
        });
        var nounou_contentm{{ loop.index }} = '' +
                '<a href="{{ path('babysitter_show', {'id': entity.id, 'url': entity.url}) }}">' +
                '   <div class="mini-profile" style="margin-left: 0;">' +
                '       <div class="header">' +
                {% if entity.user.avatar %}
                '           <img class="profile-picture" src="{{ asset('uploads/users/' ~ entity.user.avatar) }}" alt="photo de profil de {{ entity.user.firstname }}" style="height: 120px;">' +
                {% else %}
                '           <img class="profile-picture" src="{{ asset('bundles/pnpn/images/illus/nounou.jpg') }}" alt="photo de profil" style="height: 120px;">' +
                {% endif %}
                '           <strong>{{ entity.user.getHiddenName() }}</strong>' +
                '           <p>Paris</p>' +
                '       </div>' +
                '       <div class="body">' +
                '           <p>{{ entity.user.getCategories[entity.category] }}</p>' +
                '       </div>' +
                '   </div>' +
                '</a>';
        var nounou_info{{ loop.index }} = new google.maps.InfoWindow({
            content  : nounou_contentm{{ loop.index }},
            position : nounou_position{{ loop.index }},
            backgroundColor : 'rgb(134,255.200)'
        });
        google.maps.event.addListener(nounou_m{{ loop.index }}, 'click', function() {
            nounou_info{{ loop.index }}.open(map,nounou_m{{ loop.index }});
        });
        {% endif %}
        {% endfor %}
        {% if mapTop and mapBottom and mapLeft and mapRight %}
        map.fitBounds(bounds);
        minimap.fitBounds(bounds);
        {% endif %}

        // Intercept search form submit
        function sumbmitSearchForm(){
            if (!$('input[name="placeTop"]').val().length)
            {
                return false;
            }
        }

    </script>
    <script type="text/javascript">

        $(function() {
            $('.profile').hover(
                    function() {
                        $(this).children(".header").css('background-color','#e84355');
                        {% if app.environment == 'dev' %}
                        $(this).children(".header").children(".balloon").css('background-image','url(/parent_s2/web/bundles/pnpn/images/icons/balloon-white.png)');
                        {% else %}
                        $(this).children(".header").children(".balloon").css('background-image','url(../bundles/pnpn/images/icons/balloon-white.png)');
                        {% endif %}
                    }
                    , function() {
                        $(this).children(".header").css('background-color','#eeeeee');
                        {% if app.environment == 'dev' %}
                        $(this).children(".header").children(".balloon").css('background-image','url(/parent_s2/web/bundles/pnpn/images/icons/balloon-red.png)');
                        {% else %}
                        $(this).children(".header").children(".balloon").css('background-image','url(../bundles/pnpn/images/icons/balloon-red.png)');
                        {% endif %}
                    });
        })

    </script>
    <script type="text/javascript" src="{{ asset('bundles/pnpn/js/availability.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/pnpn/js/bootstrap-select.min.js') }}"></script>
    <script type="text/javascript">
        $(function() {
            $('.selectpicker').selectpicker();
        })
    </script>
{% endblock %}











{#
{% extends '::base.html.twig' %}

{% block body -%}
    <h1>Babysitter list</h1>

    <table class="records_list">
        <thead>
            <tr>
                <th>Id</th>
                <th>Presentation</th>
                <th>Experience</th>
                <th>Trustpoints</th>
                <th>Anythingelse</th>
                <th>Ageofchildren</th>
                <th>Availabilities</th>
                <th>Favoriteactivities</th>
                <th>Hobbies</th>
                <th>Mychildren</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for entity in entities %}
            <tr>
                <td><a href="{{ path('babysitter_show', { 'id': entity.id }) }}">{{ entity.id }}</a></td>
                <td>{{ entity.presentation }}</td>
                <td>{{ entity.experience }}</td>
                <td>{{ entity.trustpoints }}</td>
                <td>{{ entity.anythingelse }}</td>
                <td>{{ entity.ageofchildren }}</td>
                <td>{{ entity.availabilities }}</td>
                <td>{{ entity.favoriteactivities }}</td>
                <td>{{ entity.hobbies }}</td>
                <td>{{ entity.mychildren }}</td>
                <td>
                <ul>
                    <li>
                        <a href="{{ path('babysitter_show', { 'id': entity.id }) }}">show</a>
                    </li>
                    <li>
                        <a href="{{ path('babysitter_edit', { 'id': entity.id }) }}">edit</a>
                    </li>
                </ul>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

        <ul>
        <li>
            <a href="{{ path('babysitter_new') }}">
                Create a new entry
            </a>
        </li>
    </ul>
    {% endblock %}
#}
